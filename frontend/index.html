<!DOCTYPE html>
<html lang="vi">
<head>
    <title>Thi·ªáp M·ªùi T·ªët Nghi·ªáp</title>
    {{head}}
    <script src="/js/api_client.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/rsvp.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/vi.min.js"></script>
    <style>
        /* Custom styles for RSVP Messages Section */

        /* Smooth scroll behavior */
        #messagesContainer {
            scroll-behavior: smooth;
        }

        /* Message hover effect */
        #messagesContainer > div {
            transition: all 0.2s ease;
        }

        #messagesContainer > div:hover {
            transform: translateX(4px);
        }

        /* Avatar ring animation on hover */
        #messagesContainer img:hover {
            animation: avatarPulse 0.6s ease;
        }

        @keyframes avatarPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Message bubble animation */
        #messagesContainer .bg-gray-100 {
            transition: all 0.2s ease;
        }

        #messagesContainer > div:hover .bg-gray-100 {
            background-color: #e5e7eb;
        }

        /* Loading spinner */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* Smooth fade-in for new messages */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #messagesContainer > div {
            animation: fadeInUp 0.4s ease;
        }

        /* Button hover effects */
        #messagesContainer button {
            position: relative;
            overflow: hidden;
        }

        #messagesContainer button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1px;
            background-color: #4F46E5;
            transition: width 0.3s ease;
        }

        #messagesContainer button:hover::after {
            width: 100%;
        }

        /* Load more button effect */
        #loadMoreBtn {
            position: relative;
            overflow: hidden;
        }

        #loadMoreBtn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(79, 70, 229, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        #loadMoreBtn:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            #messagesContainer {
                font-size: 0.9rem;
            }

            #messagesContainer img {
                width: 36px;
                height: 36px;
            }

            #messagesContainer .bg-gray-100 {
                padding: 0.5rem 0.75rem;
            }
        }

        /* Empty state animation */
        #emptyState > div:first-child {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* Message count badge pulse */
        #messageCount {
            animation: badgePulse 2s ease infinite;
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Scrollbar styling for messages container */
        #messagesContainer::-webkit-scrollbar {
            width: 6px;
        }

        #messagesContainer::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        #messagesContainer::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        #messagesContainer::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>

</head>
<body class="min-h-screen">
{{header}}
<!-- Hero Section -->
<section class="container mx-auto px-4 py-16 text-center">
    <div class="max-w-3xl mx-auto">
        <!-- Avatar -->
        <!--        <img src="/assets/images/avatar.jpg"-->
        <!--             alt="Graduate"-->
        <!--             class="w-32 h-32 rounded-full mx-auto mb-6 shadow-lg border-4 border-white">-->

        <!-- Title -->
        <h1 class="text-5xl font-bold text-gray-800 mb-4">
            üéì L·ªÖ T·ªët Nghi·ªáp
        </h1>

        <p class="text-2xl text-gray-600 mb-2">
            T√¥ H·∫£i Nh·∫≠t
        </p>

        <p class="text-xl text-gray-500 mb-8">
            Khoa C√¥ng Ngh·ªá Th√¥ng Tin<br>
            Tr∆∞·ªùng ƒê·∫°i h·ªçc M·ªü TP.H·ªì Ch√≠ Minh
        </p>

        <!-- DateTime & Location Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 w-full max-w-screen-lg mx-auto">
            <div class="grid md:grid-cols-2 gap-10 text-left">
                <!-- Th·ªùi gian -->
                <div class="flex items-start space-x-3">
                    <svg class="w-6 h-6 text-indigo-600 mt-1 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                              d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                              clip-rule="evenodd"/>
                    </svg>
                    <div>
                        <h3 class="font-semibold text-gray-800">Th·ªùi gian</h3>
                        <p class="text-gray-600">13:00 - Th·ª© 7, 13/12/2025</p>
                    </div>
                </div>

                <!-- ƒê·ªãa ƒëi·ªÉm -->
                <div class="flex items-start space-x-3">
                    <svg class="w-6 h-6 text-indigo-600 mt-1 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                              d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                              clip-rule="evenodd"/>
                    </svg>
                    <div>
                        <h3 class="font-semibold text-gray-800">ƒê·ªãa ƒëi·ªÉm</h3>
                        <p class="text-gray-600 whitespace-nowrap">S·∫£nh ch·ªù
                            <br>Tr∆∞·ªùng ƒê·∫°i h·ªçc M·ªü TP.H·ªì Ch√≠ Minh</p>
                        <a target="_blank" href="https://maps.app.goo.gl/SBpokiWCAatu3gF5A"
                           class="text-indigo-600 text-sm hover:underline">Xem ƒë∆∞·ªùng ƒëi ‚Üí</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Countdown Timer -->
        <div class="flex flex-wrap items-center justify-center w-full gap-2 sm:gap-3 md:gap-4 lg:gap-6 count-down-main">
            <!-- Ng√†y -->
            <div class="timer">
                <div class="rounded-xl bg-gradient-to-b from-indigo-600 to-purple-600
                py-2 sm:py-3 px-2 sm:px-3 min-w-[70px] sm:min-w-[90px]
                flex items-center justify-center flex-col gap-1 aspect-square">
                    <h3 class="countdown-element days font-manrope font-semibold
                 text-lg sm:text-xl md:text-2xl text-white text-center">
                    </h3>
                    <p class="text-sm sm:text-base font-manrope font-normal text-white mt-1 text-center w-full">Ng√†y</p>
                </div>
            </div>

            <h3 class="font-manrope font-semibold text-xl sm:text-2xl text-gray-900">:</h3>

            <!-- Gi·ªù -->
            <div class="timer">
                <div class="rounded-xl bg-gradient-to-b from-indigo-600 to-purple-600
                py-2 sm:py-3 px-2 sm:px-3 min-w-[70px] sm:min-w-[90px]
                flex items-center justify-center flex-col gap-1 aspect-square">
                    <h3 class="countdown-element hours font-manrope font-semibold
                 text-lg sm:text-xl md:text-2xl text-white text-center">
                    </h3>
                    <p class="text-sm sm:text-base font-manrope font-normal text-white mt-1 text-center w-full">Gi·ªù</p>
                </div>
            </div>

            <h3 class="font-manrope font-semibold text-xl sm:text-2xl text-gray-900">:</h3>

            <!-- Ph√∫t -->
            <div class="timer">
                <div class="rounded-xl bg-gradient-to-b from-indigo-600 to-purple-600
                py-2 sm:py-3 px-2 sm:px-3 min-w-[70px] sm:min-w-[90px]
                flex items-center justify-center flex-col gap-1 aspect-square">
                    <h3 class="countdown-element minutes font-manrope font-semibold
                 text-lg sm:text-xl md:text-2xl text-white text-center">
                    </h3>
                    <p class="text-sm sm:text-base font-manrope font-normal text-white mt-1 text-center w-full">Ph√∫t</p>
                </div>
            </div>

            <h3 class="font-manrope font-semibold text-xl sm:text-2xl text-gray-900">:</h3>

            <!-- Gi√¢y -->
            <div class="timer">
                <div class="rounded-xl bg-gradient-to-b from-indigo-600 to-purple-600
                py-2 sm:py-3 px-2 sm:px-3 min-w-[70px] sm:min-w-[90px]
                flex items-center justify-center flex-col gap-1 aspect-square">
                    <h3 class="countdown-element seconds font-manrope font-semibold
                 text-lg sm:text-xl md:text-2xl text-white text-center">
                    </h3>
                    <p class="text-sm sm:text-base font-manrope font-normal text-white mt-1 text-center w-full">Gi√¢y</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- RSVP Form Section -->
<section class="container mx-auto px-4 py-12">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-xl p-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">
            X√°c Nh·∫≠n Tham D·ª±
        </h2>
        <p id="rsvp_notice" class="text-sm text-green-600 hidden mb-4"></p>

        <form id="rsvpForm" class="space-y-6">
            <!-- Name -->
            <div>
                <label for="rsvp_name" class="block text-sm font-medium text-gray-700">Full Name</label>
                <input id="rsvp_name" name="full_name" type="text" required
                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div>
                <label for="rsvp_email" class="block text-sm font-medium text-gray-700">Email</label>
                <input id="rsvp_email" name="email" type="email" required
                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div>
                <label for="rsvp_phone" class="block text-sm font-medium text-gray-700">Phone</label>
                <input id="rsvp_phone" name="phone" type="tel"
                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <div>
                <label for="attendance" class="block text-sm font-medium text-gray-700">Will you attend?</label>
                <select id="attendance" name="attendance"
                        class="w-full border rounded-lg px-3 py-2">
                    <option value="yes">C√≥</option>
                    <option id="option-no" value="no">
                        Kh√¥ng/Khong/Khum/Khom/K/Kh/Khg/Ko/Kg/H√¥ng/Hong/Hog/Hok/Hk/Hum/HƒÉm/Hem
                    </option>
                    <option value="maybe">Ch∆∞a ch·∫Øc</option>
                </select>
            </div>

            <div>
                <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
                <textarea id="message" name="message" rows="3"
                          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                          placeholder="Any message..."></textarea>
            </div>

            <button type="submit"
                    class="w-full bg-indigo-600 text-white font-medium py-2 rounded-lg hover:bg-indigo-700">
                G·ª≠i
            </button>
        </form>

        <!-- Success Message (hidden by default) -->
        <div id="successMessage" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <p class="text-green-800 text-center">
                ‚úÖ C·∫£m ∆°n b·∫°n ƒë√£ x√°c nh·∫≠n! H·∫πn g·∫∑p l·∫°i t·∫°i l·ªÖ t·ªët nghi·ªáp.
            </p>
        </div>
    </div>
</section>
<!-- RSVP Messages Section (gi·ªëng Facebook Comments) -->
<section class="container mx-auto px-4 py-12">
    <div class="max-w-3xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6 pb-4 border-b">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    üí¨ L·ªùi nh·∫Øn t·ª´ m·ªçi ng∆∞·ªùi
                </h2>
                <span id="messageCount" class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                    0 tin nh·∫Øn
                </span>
            </div>

            <!-- Messages Container -->
            <div id="messagesContainer" class="space-y-0 max-h-[600px] overflow-y-auto overflow-x-hidden">
                <!-- Loading State -->
                <div id="loadingMessages" class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                    <p class="text-gray-500 mt-2">ƒêang t·∫£i tin nh·∫Øn...</p>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="hidden text-center py-12">
                    <div class="text-6xl mb-4">üí≠</div>
                    <p class="text-gray-500 text-lg">Ch∆∞a c√≥ l·ªùi nh·∫Øn n√†o</p>
                    <p class="text-gray-400 text-sm mt-2">H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n g·ª≠i l·ªùi ch√∫c!</p>
                </div>
            </div>

            <!-- Load More Button - REMOVED -->
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="container mx-auto px-4 py-12">
    <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
            Th·ªëng K√™ X√°c Nh·∫≠n
        </h2>

        <div class="grid md:grid-cols-3 gap-6" id="stats">
            <!-- Will be populated by JS -->
        </div>
    </div>
</section>


<script>
    function updateOptionText() {
        // L·∫•y th·∫ª option b·∫±ng ID ƒë√£ ƒë·∫∑t
        const optionNo = document.getElementById('option-no');

        if (!optionNo) return; // Ki·ªÉm tra n·∫øu kh√¥ng t√¨m th·∫•y th·∫ª th√¨ d·ª´ng

        // Ki·ªÉm tra chi·ªÅu r·ªông m√†n h√¨nh (768px l√† k√≠ch th∆∞·ªõc tablet/mobile ph·ªï bi·∫øn)
        if (window.innerWidth < 768) {
            // N·∫øu l√† m√†n h√¨nh nh·ªè -> Hi·ªÉn th·ªã ch·ªØ ng·∫Øn
            optionNo.textContent = 'Hong';
        } else {
            // N·∫øu l√† m√†n h√¨nh l·ªõn -> Hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß
            optionNo.textContent = 'Kh√¥ng/Khong/Khum/Khom/K/Kh/Khg/Ko/Kg/H√¥ng/Hong/Hog/Hok/Hk/Hum/HƒÉm/Hem';
        }
    }

    // Ch·∫°y h√†m 1 l·∫ßn ngay khi t·∫£i trang
    updateOptionText();

    // Ch·∫°y l·∫°i h√†m m·ªói khi ng∆∞·ªùi d√πng thay ƒë·ªïi k√≠ch th∆∞·ªõc c·ª≠a s·ªï
    window.addEventListener('resize', updateOptionText);
    // count-down timer
    let dest = new Date("dec 13, 2025 13:00:00").getTime();
    let x = setInterval(function () {
        let now = new Date().getTime();
        let diff = dest - now;

// Check if the countdown has reached zero or negative
        if (diff <= 0) {
            clearInterval(x); // Stop the countdown
            return; // Exit the function
        }

        let days = Math.floor(diff / (1000 * 60 * 60 * 24));
        let hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        let seconds = Math.floor((diff % (1000 * 60)) / 1000);

        if (days < 10) {
            days = `0${days}`;
        }
        if (hours < 10) {
            hours = `0${hours}`;
        }
        if (minutes < 10) {
            minutes = `0${minutes}`;
        }
        if (seconds < 10) {
            seconds = `0${seconds}`;
        }

// Get elements by class name
        let countdownElements = document.getElementsByClassName("countdown-element");

// Loop through the elements and update their content
        for (let i = 0; i < countdownElements.length; i++) {
            let className = countdownElements[i].classList[1]; // Get the second class name
            switch (className) {
                case "days":
                    countdownElements[i].innerHTML = days;
                    break;
                case "hours":
                    countdownElements[i].innerHTML = hours;
                    break;
                case "minutes":
                    countdownElements[i].innerHTML = minutes;
                    break;
                case "seconds":
                    countdownElements[i].innerHTML = seconds;
                    break;
                default:
                    break;
            }
        }
    }, 1000);

    // Set moment locale to Vietnamese
    moment.locale('vi');

    const API_BASE_URL = 'http://localhost:8080/api';

    // Load RSVP messages - load all at once since we have scrollbar
    async function loadRSVPMessages(page = 1) {
        try {
            // Load all messages (high limit since we're scrolling)
            const response = await fetch(`${API_BASE_URL}/rsvp/messages?page=${page}&limit=100`);
            const data = await response.json();

            if (data.success) {
                const messages = data.data || [];

                // Hide loading on first page
                if (page === 1) {
                    document.getElementById('loadingMessages').classList.add('hidden');
                }

                // Show empty state if no messages
                if (messages.length === 0 && page === 1) {
                    document.getElementById('emptyState').classList.remove('hidden');
                    return;
                } else {
                    document.getElementById('emptyState').classList.add('hidden');
                }

                // Update message count
                const total = data.total || messages.length;
                document.getElementById('messageCount').textContent = `${total} tin nh·∫Øn`;

                // Render messages
                const container = document.getElementById('messagesContainer');

                // Clear container on first page
                if (page === 1) {
                    container.innerHTML = '';
                }

                messages.forEach(msg => {
                    const messageElement = createRSVPMessageElement(msg);
                    container.appendChild(messageElement);
                });
            }
        } catch (error) {
            console.error('Error loading messages:', error);
            if (page === 1) {
                document.getElementById('loadingMessages').innerHTML =
                    '<p class="text-red-500">Kh√¥ng th·ªÉ t·∫£i tin nh·∫Øn. Vui l√≤ng th·ª≠ l·∫°i sau.</p>';
            }
        }
    }

    // Create message element (Simple style)
    function createRSVPMessageElement(msg) {
        const div = document.createElement('div');
        div.className = 'flex gap-2.5 py-3 border-b border-gray-100 last:border-0';

        // Format time using moment.js
        const timeAgo = moment(msg.created_at).fromNow();
        const fullDate = moment(msg.created_at).format('dddd, DD/MM/YYYY [l√∫c] HH:mm');

        // Generate avatar URL
        const avatarUrl = msg.avatar || `https://res.cloudinary.com/dcncfkvwv/image/upload/v1733476463/sum8iqnxhdgdyj6zcc2l.jpg`;

        div.innerHTML = `
            <!-- Avatar -->
            <div class="flex-shrink-0">
                <img src="${avatarUrl}"
                     alt="${escapeHtml(msg.name)}"
                     class="w-10 h-10 rounded-full object-cover"
                     onerror="this.src='https://res.cloudinary.com/dcncfkvwv/image/upload/v1733476463/sum8iqnxhdgdyj6zcc2l.jpg'">
            </div>

            <!-- Message Content -->
            <div class="flex-1 min-w-0 overflow-hidden">
                <!-- Name and Time -->
                <div class="flex items-baseline justify-between mb-1 gap-2">
                    <h3 class="font-semibold text-gray-900 text-sm truncate">
                        ${escapeHtml(msg.name)}
                    </h3>
                    <span class="text-xs text-gray-400 flex-shrink-0" title="${fullDate}">
                        ${timeAgo}
                    </span>
                </div>

                <!-- Message Text -->
                <p class="text-gray-700 text-sm break-words leading-relaxed overflow-wrap-anywhere">
                    ${escapeHtml(msg.message)}
                </p>
            </div>
        `;

        return div;
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    // Reload messages after form submission
    const originalRSVPFormSubmit = document.getElementById('rsvpForm').onsubmit;
    document.getElementById('rsvpForm').addEventListener('submit', async function(e) {
        // Let the original handler run first
        if (originalRSVPFormSubmit) {
            await originalRSVPFormSubmit.call(this, e);
        }

        // After successful submission, reload messages
        setTimeout(() => {
            loadRSVPMessages(1);
        }, 1000);
    });

    // Auto-refresh messages every 30 seconds
    setInterval(() => {
        loadRSVPMessages(1);
    }, 30000);

    // Initial load
    loadRSVPMessages(1);
</script>
{{footer}}
</body>
</html>